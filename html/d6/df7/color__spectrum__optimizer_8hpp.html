<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>pbpt: /Users/jinceyang/Desktop/codebase/graphics/pbpt/src/radiometry/color_spectrum_optimizer.hpp File Reference</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../clipboard.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<script type="text/javascript" src="../../cookie.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">pbpt
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('d6/df7/color__spectrum__optimizer_8hpp.html','../../',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">color_spectrum_optimizer.hpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Optimization utilities for fitting RGB colors to smooth spectra.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;array&gt;</code><br />
<code>#include &quot;math/matrix.hpp&quot;</code><br />
<code>#include &quot;math/operator.hpp&quot;</code><br />
<code>#include &quot;math/vector.hpp&quot;</code><br />
<code>#include &quot;math/format.hpp&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d4/dbe/spectrum__distribution_8hpp_source.html">spectrum_distribution.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d6/dfd/color_8hpp_source.html">color.hpp</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="../../d8/d7c/color__space_8hpp_source.html">color_space.hpp</a>&quot;</code><br />
</div>
<p><a href="../../d6/df7/color__spectrum__optimizer_8hpp_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-nested-classes" class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:pbpt_3A_3Aradiometry_3A_3ARGBSigmoidPolynomialOptimizationResult_3C_20T_20_3E" id="r_pbpt_3A_3Aradiometry_3A_3ARGBSigmoidPolynomialOptimizationResult_3C_20T_20_3E"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d0/d37/structpbpt_1_1radiometry_1_1_r_g_b_sigmoid_polynomial_optimization_result.html">pbpt::radiometry::RGBSigmoidPolynomialOptimizationResult&lt; T &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Result of optimizing <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html" title="Generic linear RGB color triplet.">RGB</a> sigmoid polynomial coefficients.  <a href="../../d0/d37/structpbpt_1_1radiometry_1_1_r_g_b_sigmoid_polynomial_optimization_result.html#details">More...</a><br /></td></tr>
<tr class="memitem:pbpt_3A_3Aradiometry_3A_3AScaledRGB_3C_20T_20_3E" id="r_pbpt_3A_3Aradiometry_3A_3AScaledRGB_3C_20T_20_3E"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="../../d9/d0c/structpbpt_1_1radiometry_1_1_scaled_r_g_b.html">pbpt::radiometry::ScaledRGB&lt; T &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html" title="Generic linear RGB color triplet.">RGB</a> value scaled into a displayable range plus an overall factor.  <a href="../../d9/d0c/structpbpt_1_1radiometry_1_1_scaled_r_g_b.html#details">More...</a><br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a29d055bdd4532fff7e4cf36268318b09" id="r_a29d055bdd4532fff7e4cf36268318b09"><td class="memTemplParams" colspan="2">template&lt;typename T, typename LuminantSpectrumType&gt; </td></tr>
<tr class="memitem:a29d055bdd4532fff7e4cf36268318b09 template"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d0/d37/structpbpt_1_1radiometry_1_1_r_g_b_sigmoid_polynomial_optimization_result.html">RGBSigmoidPolynomialOptimizationResult</a>&lt; T &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a29d055bdd4532fff7e4cf36268318b09">pbpt::radiometry::optimize_albedo_rgb_sigmoid_polynomial</a> (const <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html">RGB</a>&lt; T &gt; &amp;target_rgb, const <a class="el" href="../../d6/d05/classpbpt_1_1radiometry_1_1_r_g_b_color_space.html">RGBColorSpace</a>&lt; T &gt; &amp;color_space, const LuminantSpectrumType &amp;reference_luminant_spectrum, int max_iterations=300, double learning_rate=1.0, double delta_x=1e-4, double error_threshold=1e-2, const std::array&lt; T, 3 &gt; &amp;initial_guess={0.0, 0.0, 0.0}, bool verbose=false)</td></tr>
<tr class="memdesc:a29d055bdd4532fff7e4cf36268318b09"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fits an albedo <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html" title="Generic linear RGB color triplet.">RGB</a> sigmoid-polynomial spectrum to a target <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html" title="Generic linear RGB color triplet.">RGB</a> color.  <br /></td></tr>
<tr class="memitem:a12084af5df422324d27fc58a42c71a80" id="r_a12084af5df422324d27fc58a42c71a80"><td class="memTemplParams" colspan="2">template&lt;typename T&gt; </td></tr>
<tr class="memitem:a12084af5df422324d27fc58a42c71a80 template"><td class="memItemLeft" align="right" valign="top"><a class="el" href="../../d9/d0c/structpbpt_1_1radiometry_1_1_scaled_r_g_b.html">ScaledRGB</a>&lt; T &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a12084af5df422324d27fc58a42c71a80">pbpt::radiometry::scale_unbounded_rgb</a> (const <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html">RGB</a>&lt; T &gt; &amp;rgb)</td></tr>
<tr class="memdesc:a12084af5df422324d27fc58a42c71a80"><td class="mdescLeft">&#160;</td><td class="mdescRight">Factorizes an unbounded <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html" title="Generic linear RGB color triplet.">RGB</a> color into a bounded <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html" title="Generic linear RGB color triplet.">RGB</a> and a scale.  <br /></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Optimization utilities for fitting RGB colors to smooth spectra. </p>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a29d055bdd4532fff7e4cf36268318b09" name="a29d055bdd4532fff7e4cf36268318b09"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29d055bdd4532fff7e4cf36268318b09">&#9670;&#160;</a></span>optimize_albedo_rgb_sigmoid_polynomial()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T, typename LuminantSpectrumType&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">RGBSigmoidPolynomialOptimizationResult&lt; T &gt; pbpt::radiometry::optimize_albedo_rgb_sigmoid_polynomial </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html">RGB</a>&lt; T &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>target_rgb</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="../../d6/d05/classpbpt_1_1radiometry_1_1_r_g_b_color_space.html">RGBColorSpace</a>&lt; T &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>color_space</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const LuminantSpectrumType &amp;</td>          <td class="paramname"><span class="paramname"><em>reference_luminant_spectrum</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int</td>          <td class="paramname"><span class="paramname"><em>max_iterations</em></span><span class="paramdefsep"> = </span><span class="paramdefval">300</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>learning_rate</em></span><span class="paramdefsep"> = </span><span class="paramdefval">1.0</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>delta_x</em></span><span class="paramdefsep"> = </span><span class="paramdefval">1e-4</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">double</td>          <td class="paramname"><span class="paramname"><em>error_threshold</em></span><span class="paramdefsep"> = </span><span class="paramdefval">1e-2</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::array&lt; T, 3 &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>initial_guess</em></span><span class="paramdefsep"> = </span><span class="paramdefval">{0.0,&#160;0.0,&#160;0.0}</span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool</td>          <td class="paramname"><span class="paramname"><em>verbose</em></span><span class="paramdefsep"> = </span><span class="paramdefval">false</span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Fits an albedo RGB sigmoid-polynomial spectrum to a target RGB color. </p>
<p>The optimization works in CIE LAB space:</p><ul>
<li>The target RGB color is converted to XYZ and then to LAB using the provided RGB color space and its white point.</li>
<li>A parametric reflectance spectrum is defined by a normalized RGB sigmoid polynomial with three coefficients.</li>
<li>For a given coefficient vector, the corresponding reflectance is converted to XYZ under the reference illuminant and then to LAB.</li>
<li>The LAB difference between target and current color is used as the 3D error vector.</li>
</ul>
<p>A simple Newton-style iteration is performed: the Jacobian matrix of partial derivatives of the LAB error with respect to the three coefficients is approximated by symmetric finite differences. The resulting 3x3 linear system is solved and the coefficients are updated by a scaled step. Iteration stops when all LAB errors are below <code class="param">error_threshold</code> or when <code class="param">max_iterations</code> is reached.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>Scalar type. </td></tr>
    <tr><td class="paramname">LuminantSpectrumType</td><td>Spectrum type used for the reference illuminant. </td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">target_rgb</td><td>Target RGB color to match. </td></tr>
    <tr><td class="paramname">color_space</td><td>RGB color space describing primaries and white. </td></tr>
    <tr><td class="paramname">reference_luminant_spectrum</td><td>Illuminant used to light the reflectance. </td></tr>
    <tr><td class="paramname">max_iterations</td><td>Maximum number of Newton iterations. </td></tr>
    <tr><td class="paramname">learning_rate</td><td>Step size scaling applied to the Newton update. </td></tr>
    <tr><td class="paramname">delta_x</td><td>Finite-difference step for Jacobian estimation. </td></tr>
    <tr><td class="paramname">error_threshold</td><td>Per-channel LAB error threshold for convergence. </td></tr>
    <tr><td class="paramname">initial_guess</td><td>Initial coefficients for the sigmoid polynomial. </td></tr>
    <tr><td class="paramname">verbose</td><td>If true, prints iteration diagnostics to stdout.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Optimization result containing the final LAB error and coefficients. </dd></dl>

</div>
</div>
<a id="a12084af5df422324d27fc58a42c71a80" name="a12084af5df422324d27fc58a42c71a80"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a12084af5df422324d27fc58a42c71a80">&#9670;&#160;</a></span>scale_unbounded_rgb()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T&gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ScaledRGB&lt; T &gt; pbpt::radiometry::scale_unbounded_rgb </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="../../d8/d62/classpbpt_1_1radiometry_1_1_r_g_b.html">RGB</a>&lt; T &gt; &amp;</td>          <td class="paramname"><span class="paramname"><em>rgb</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel inline">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Factorizes an unbounded RGB color into a bounded RGB and a scale. </p>
<p>The maximum channel component is used to define a scale factor so that the scaled RGB components remain within a comfortable range (here the maximum becomes 0.5). The original color is recovered as rgb_scaled * scale.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">rgb</td><td>Input (potentially unbounded) RGB color. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>ScaledRGB containing a bounded RGB value and a positive scale. </dd></dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="../../dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="../../dir_8a23e627dedca06beec39c4f95ed26a2.html">radiometry</a></li><li class="navelem"><a href="../../d6/df7/color__spectrum__optimizer_8hpp.html">color_spectrum_optimizer.hpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
